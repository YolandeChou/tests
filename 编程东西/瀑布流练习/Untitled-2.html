<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>桌面档</title>

<style>
*{
	padding:0;
	margin:0;
}
#demo{
	position:relative;
}

.item{
	padding:15px 0 0  15px;
	float:left;
}
.img{
	padding:10px;
	border:1px solid #ccc;
	box-shadow:0 0 6px #ccc;
	border-radius:5px;
}
.img img{
	width:162px;
	height:auto;
}
</style>
</head>

<body>
<div id='demo'>
  <div class='item'>
    <div class='img'><img src="0.jpg" />
    </div>
  </div>
 
  <div class='item'>
    <div class='img'><img src="1.jpg" />
    </div>
  </div>
 
  <div class='item'>
    <div class='img'><img src="2.jpg" />
    </div>
  </div>
 
  <div class='item'>
    <div class='img'><img src="3.jpg" />
    </div>
  </div>

  <div class='item'>
    <div class='img'><img src="4.jpg" />
    </div>
  </div>

  <div class='item'>
    <div class='img'><img src="5.jpg" />
    </div>
  </div>
 
 <div class='item'>
  <div class='img'><img src="6.jpg" />
  </div>
</div>

  <div class='item'>
    <div class='img'><img src="7.jpg" />
    </div>
  </div>

  <div class='item'>
    <div class='img'><img src="8.jpg" />
    </div>
  </div>

  <div class='item'>
    <div class='img'><img src="9.jpg" />
    </div>
  </div>
 
  <div class='item'>
    <div class='img'><img src="10.jpg" />
    </div>
  </div>
 
  <div class='item'>
    <div class='img'><img src="11.jpg" />
    </div>
  </div>
 
  <div class='item'>
    <div class='img'><img src="12.jpg" />
    </div>
  </div>
 
  <div class='item'>
    <div class='img'><img src="13.jpg" />
    </div>
  </div>
 
  <div class='item'>
    <div class='img'><img src="14.jpg" />
    </div>
  </div>
 
   <div class='item'>
    <div class='img'><img src="15.jpg" />
    </div>
  </div>
 
  <div class='item'>
    <div class='img'><img src="16.jpg" />
    </div>
  </div>
 
  <div class='item'>
    <div class='img'><img src="17.jpg" />
    </div>
  </div>
 
  <div class='item'>
    <div class='img'><img src="18.jpg" />
    </div>
  </div>
 
  <div class='item'>
    <div class='img'><img src="19.jpg" />
    </div>
  </div>
 
  <div class='item'>
    <div class='img'><img src="20.jpg" />
    </div>
  </div>
 
  <div class='item'>
    <div class='img'><img src="21.jpg" />
    </div>
  </div>
 
  <div class='item'>
    <div class='img'><img src="22.jpg" />
    </div>
  </div>
 

</div>

<script src="file:///C|/Users/Yolande/Desktop/53a94b1500011f1b00000000/源码/jQuery/js/jquery-1.8.3.min.js"></script>
<script>
$(window).on('load',function(){
	waterfall('demo','item');
	
})
var dataInt={'data':[{'src':'23.jpg'},{'src':'24.jpg'},{'src':'25.jpg'},{'src':'26.jpg'},{'src':'27.jpg'},{'src':'28.jpg'},{'src':'29.jpg'},{'src':'30.jpg'},{'src':'31.jpg'},{'src':'32.jpg'},{'src':'33.jpg'},{'src':'34.jpg'},{'src':'35.jpg'},{'src':'36.jpg'},{'src':'37.jpg'},{'src':'38.jpg'},{'src':'39.jpg'},]}
$(window).on('scroll',function(){
	if(checkScroll){
		$.each(dataInt.data,function(index,value){
			var $oBox=$('<div>').addClass('item').appendTo($('#demo'));
			var $oImg=$('<div>').addClass('img').appendTo($oBox);
			$('<img>').attr('src',$(value).attr('src')).appendTo($oImg);
		});
		waterfall();
	}
})

function waterfall(parent,cls){
	var $oItem=$('#demo>div');
	var objW=$oItem.eq(0).outerWidth();
	var winW=$(window).width();
	var num=Math.floor(winW/objW);
	$('#demo').width(num*objW).css('margin','0 auto');
	var hArry=[];
	$oItem.each(function(index,value){
		if(index<num){
			hArry[index]=$oItem.eq(index).height();
		}else{
			var minH=Math.min.apply(null,hArry);
			var minHIndex=$.inArray(minH,hArry);
			$(value).css({
				'position':'absolute',
				'top':minH,
				'left':$oItem.eq(minHIndex).position().left
			})
			hArry[minHIndex]+=$oItem.eq(index).height();
		}
	});

}

function checkScroll(){
	var $oItem=$('#demo>div');
	var windH=$(document).height();
	var scrollH=$(window).scrollTop();
	var objH=$oItem.last().get(0).offsetTop + Math.floor($oItem.last().height()/2);
	return(objH<windH+scrollH)?true:false;
}
</script>
</body>
</html>
